{"version":3,"file":"olcesium-debug.js","mappings":"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","sources":["webpack://olcs_unused_var/./src/olcs/AbstractSynchronizer.js","webpack://olcs_unused_var/./src/olcs/AutoRenderLoop.js","webpack://olcs_unused_var/./src/olcs/Camera.js","webpack://olcs_unused_var/./src/olcs/FeatureConverter.js","webpack://olcs_unused_var/./src/olcs/MVTImageryProvider.js","webpack://olcs_unused_var/./src/olcs/OLCesium.js","webpack://olcs_unused_var/./src/olcs/OverlaySynchronizer.js","webpack://olcs_unused_var/./src/olcs/RasterSynchronizer.js","webpack://olcs_unused_var/./src/olcs/SynchronizedOverlay.js","webpack://olcs_unused_var/./src/olcs/VectorSynchronizer.js","webpack://olcs_unused_var/./src/olcs/contrib/LazyLoader.js","webpack://olcs_unused_var/./src/olcs/contrib/Manager.js","webpack://olcs_unused_var/./src/olcs/core.js","webpack://olcs_unused_var/./src/olcs/core/OLImageryProvider.js","webpack://olcs_unused_var/./src/olcs/core/VectorLayerCounterpart.js","webpack://olcs_unused_var/./src/olcs/math.js","webpack://olcs_unused_var/./src/olcs/util.js","webpack://olcs_unused_var/external var \"ol.Observable\"","webpack://olcs_unused_var/external var \"ol.Overlay\"","webpack://olcs_unused_var/external var \"ol.easing\"","webpack://olcs_unused_var/external var \"ol.extent\"","webpack://olcs_unused_var/external var \"ol.format.MVT\"","webpack://olcs_unused_var/external var \"ol.geom.Geometry\"","webpack://olcs_unused_var/external var \"ol.geom.Point\"","webpack://olcs_unused_var/external var \"ol.geom.Polygon\"","webpack://olcs_unused_var/external var \"ol.geom.SimpleGeometry\"","webpack://olcs_unused_var/external var \"ol.layer.Group\"","webpack://olcs_unused_var/external var \"ol.layer.Image\"","webpack://olcs_unused_var/external var \"ol.layer.Layer\"","webpack://olcs_unused_var/external var \"ol.layer.Tile\"","webpack://olcs_unused_var/external var \"ol.layer.Vector\"","webpack://olcs_unused_var/external var \"ol.layer.VectorTile\"","webpack://olcs_unused_var/external var \"ol.proj\"","webpack://olcs_unused_var/external var \"ol.render\"","webpack://olcs_unused_var/external var \"ol.source\"","webpack://olcs_unused_var/external var \"ol.source.Cluster\"","webpack://olcs_unused_var/external var \"ol.source.Image\"","webpack://olcs_unused_var/external var \"ol.source.ImageStatic\"","webpack://olcs_unused_var/external var \"ol.source.ImageWMS\"","webpack://olcs_unused_var/external var \"ol.source.TileImage\"","webpack://olcs_unused_var/external var \"ol.source.TileWMS\"","webpack://olcs_unused_var/external var \"ol.source.Vector\"","webpack://olcs_unused_var/external var \"ol.source.VectorTile\"","webpack://olcs_unused_var/external var \"ol.structs.LRUCache\"","webpack://olcs_unused_var/external var \"ol.style.Icon\"","webpack://olcs_unused_var/external var \"ol.style.Stroke\"","webpack://olcs_unused_var/external var \"ol.style.Style\"","webpack://olcs_unused_var/external var \"ol.tilegrid\"","webpack://olcs_unused_var/external var \"ol.tileurlfunction\"","webpack://olcs_unused_var/external var \"ol.util\"","webpack://olcs_unused_var/webpack/bootstrap","webpack://olcs_unused_var/webpack/runtime/compat get default export","webpack://olcs_unused_var/webpack/runtime/define property getters","webpack://olcs_unused_var/webpack/runtime/hasOwnProperty shorthand","webpack://olcs_unused_var/webpack/runtime/make namespace object","webpack://olcs_unused_var/./src/index.library.js"],"sourcesContent":["/**\n * @module olcs.AbstractSynchronizer\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {olcsListen, getUid} from './util.js';\n\n\nclass AbstractSynchronizer {\n  /**\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @template T\n   * @abstract\n   * @api\n   */\n  constructor(map, scene) {\n    /**\n     * @type {!ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.View}\n     * @protected\n     */\n    this.view = map.getView();\n\n    /**\n     * @type {!Cesium.Scene}\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * @type {ol.Collection.<ol.layer.Base>}\n     * @protected\n     */\n    this.olLayers = map.getLayerGroup().getLayers();\n\n    /**\n     * @type {ol.layer.Group}\n     */\n    this.mapLayerGroup = map.getLayerGroup();\n\n    /**\n     * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n     * Null value means, that we are unable to create equivalent layers.\n     * @type {Object.<string, ?Array.<T>>}\n     * @protected\n     */\n    this.layerMap = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer layers ids (from getUid).\n     * @type {!Object.<string, Array<ol.EventsKey>>}\n     * @protected\n     */\n    this.olLayerListenKeys = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer groups ids (from getUid).\n     * @type {!Object.<string, !Array.<ol.EventsKey>>}\n     * @private\n     */\n    this.olGroupListenKeys_ = {};\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   * @api\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @protected\n   */\n  orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  addLayers_(root) {\n    /** @type {Array<import('olsc/core.js').LayerWithParents>} */\n    const fifo = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof olLayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = (e) => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(olcsListen(layerWithParents.layer, 'change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   * @param {Array.<T>} cesiumObjects\n   * @param {string} layerId\n   * @param {ol.layer.Base} layer\n   * @private\n   */\n  addCesiumObjects_(cesiumObjects, layerId, layer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(olcsListen(layer, 'change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   * @private\n   */\n  removeAndDestroySingleLayer_(layer) {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  unlistenSingleGroup_(group) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  removeLayer_(root) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof olLayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  listenForGroupChanges_(group) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   * @protected\n   */\n  destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  addCesiumObject(object) {}\n\n  /**\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  destroyCesiumObject(object) {}\n\n  /**\n   * Remove single Cesium object from the collection.\n   * @param {!T} object\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeSingleCesiumObject(object, destroy) {}\n\n  /**\n   * Remove all Cesium objects from the collection.\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeAllCesiumObjects(destroy) {}\n\n  /**\n   * @param {import('olsc/core.js').LayerWithParents} olLayerWithParents\n   * @return {?Array.<T>}\n   * @abstract\n   * @protected\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {}\n}\n\n\nexport default AbstractSynchronizer;\n","/**\n * @module olcs.AutoRenderLoop\n */\n\nclass AutoRenderLoop {\n  /**\n   * @constructor\n   * @param {olcs.OLCesium} ol3d\n   */\n  constructor(ol3d) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n    this.repaintEventNames_ = [\n      'mousemove', 'mousedown', 'mouseup',\n      'touchstart', 'touchend', 'touchmove',\n      'pointerdown', 'pointerup', 'pointermove',\n      'wheel'\n    ];\n\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   * @api\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n\n\nexport default AutoRenderLoop;\n","/**\n * @module olcs.Camera\n */\n\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsCore, {calcDistanceForResolution, calcResolutionForDistance} from './core.js';\n\nclass Camera {\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   * @param {!Cesium.Scene} scene\n   * @param {!ol.Map} map\n   * @api\n   */\n  constructor(scene, map) {\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = scene;\n\n    /**\n     * @type {!Cesium.Camera}\n     * @private\n     */\n    this.cam_ = scene.camera;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {?ol.View}\n     * @private\n     */\n    this.view_ = null;\n\n    /**\n     * @type {?ol.EventsKey}\n     * @private\n     */\n    this.viewListenKey_ = null;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.toLonLat_ = Camera.identityProjection;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.fromLonLat_ = Camera.identityProjection;\n\n    /**\n     * 0 -- topdown, PI/2 -- the horizon\n     * @type {number}\n     * @private\n     */\n    this.tilt_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.distance_ = 0;\n\n    /**\n     * @type {?Cesium.Matrix4}\n     * @private\n     */\n    this.lastCameraViewMatrix_ = null;\n\n    /**\n     * This is used to discard change events on view caused by updateView method.\n     * @type {boolean}\n     * @private\n     */\n    this.viewUpdateInProgress_ = false;\n\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  /**\n   * @param {Array.<number>} input Input coordinate array.\n   * @param {Array.<number>=} opt_output Output array of coordinate values.\n   * @param {number=} opt_dimension Dimension.\n   * @return {Array.<number>} Input coordinate array (same array as input).\n   */\n  static identityProjection(input, opt_output, opt_dimension) {\n    const dim = opt_dimension || input.length;\n    if (opt_output) {\n      for (let i = 0; i < dim; ++i) {\n        opt_output[i] = input[i];\n      }\n    }\n    return input;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewEvent_(e));\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = Camera.identityProjection;\n      this.fromLonLat_ = Camera.identityProjection;\n    }\n  }\n\n  /**\n   * @param {?} e\n   * @private\n   */\n  handleViewEvent_(e) {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @param {number} heading In radians.\n   * @api\n   */\n  setHeading(heading) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @return {number|undefined} Heading in radians.\n   * @api\n   */\n  getHeading() {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param {number} tilt In radians.\n   * @api\n   */\n  setTilt(tilt) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return {number} Tilt in radians.\n   * @api\n   */\n  getTilt() {\n    return this.tilt_;\n  }\n\n  /**\n   * @param {number} distance In meters.\n   * @api\n   */\n  setDistance(distance) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Distance in meters.\n   * @api\n   */\n  getDistance() {\n    return this.distance_;\n  }\n\n  /**\n   * Shortcut for ol.View.setCenter().\n   * @param {!ol.Coordinate} center Same projection as the ol.View.\n   * @api\n   */\n  setCenter(center) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param {!ol.Coordinate} position Same projection as the ol.View.\n   * @api\n   */\n  setPosition(position) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getPosition() {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param {number} altitude In meters.\n   * @api\n   */\n  setAltitude(altitude) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Altitude in meters.\n   * @api\n   */\n  getAltitude() {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   * @private\n   */\n  updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    /** @type {Cesium.optionsOrientation} */\n    const orientation = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   * @api\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   * @api\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = olcsCore.pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param {boolean=} opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param {number} resolution Number of map units per pixel.\n   * @param {number} latitude Latitude in radians.\n   * @return {number} The calculated distance.\n   * @api\n   */\n  calcDistanceForResolution(resolution, latitude) {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param {number} distance\n   * @param {number} latitude\n   * @return {number} The calculated resolution.\n   * @api\n   */\n  calcResolutionForDistance(distance, latitude) {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n\n\nexport default Camera;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport olcsCore from './core.js';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.js';\nimport olcsUtil, {getUid, isGroundPolylinePrimitiveSupported} from './util.js';\n\n\n/**\n * @typedef {Object} ModelStyle\n * @property {Cesium.Matrix4} [debugModelMatrix]\n * @property {Cesium.ModelFromGltfOptions} cesiumOptions\n */\n\n\nclass FeatureConverter {\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param {!Cesium.Scene} scene Cesium scene.\n   * @constructor\n   * @api\n   */\n  constructor(scene) {\n\n    /**\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * Bind once to have a unique function for using as a listener\n     * @type {function(ol.source.Vector.Event)}\n     * @private\n     */\n    this.boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n    /**\n     * @type {Cesium.Cartesian3}\n     * @private\n     */\n    this.defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n  }\n\n  /**\n   * @param {ol.source.Vector.Event} evt\n   * @private\n   */\n  onRemoveOrClearFeature_(evt) {\n    const source = evt.target;\n    console.assert(source instanceof olSourceVector);\n\n    const cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n   * @protected\n   */\n  setReferenceForPicking(layer, feature, primitive) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} geometry\n   * @param {!Cesium.Color} color\n   * @param {number=} opt_lineWidth\n   * @return {Cesium.Primitive}\n   * @protected\n   */\n  createColoredPrimitive(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n    const createInstance = function(geometry, color) {\n      const instance = new Cesium.GeometryInstance({\n        // always update Cesium externs before adding a property\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options = {\n      // always update Cesium externs before adding a property\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      if (!options.renderState) {\n        options.renderState = {};\n      }\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const ctor = instances.geometry.constructor;\n      if (ctor && !ctor['createShadowVolume']) {\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.PerInstanceColorAppearance(options);\n    }\n\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @param {boolean} outline\n   * @return {!Cesium.Color}\n   * @protected\n   */\n  extractColorFromOlStyle(style, outline) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return olcsCore.convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @return {number}\n   * @protected\n   */\n  extractLineWidthFromOlStyle(style) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} fillGeometry\n   * @param {!Cesium.Geometry} outlineGeometry\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  wrapFillAndOutlineGeometries(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.Primitive} primitive current primitive\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  addTextStyle(layer, feature, geometry, style, primitive) {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @return {!Cesium.Billboard} newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards, bbOptions, layer, feature, geometry, style) {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olCircleGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    let center = olGeometry.getCenter();\n    const height = center.length == 3 ? center[2] : 0.0;\n    let point = center.slice();\n    point[0] += olGeometry.getRadius();\n\n    // Cesium\n    center = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n    point = olcsCore.ol4326CoordinateToCesiumCartesian(point);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      // always update Cesium externs before adding a property\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive, outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n          const color = this.extractColorFromOlStyle(olStyle, true);\n          outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n        } else {\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            geometryInstances: new Cesium.GeometryInstance({\n              geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n            }),\n            appearance: new Cesium.PolylineMaterialAppearance({\n              material: this.olStyleToCesium(feature, olStyle, true),\n            }),\n            classificationType: Cesium.ClassificationType.TERRAIN,\n          });\n          outlinePrimitive.readyPromise.then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        // always update Cesium externs before adding a property\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!number} width The width of the line.\n   * @param {!Cesium.Color} color The color of the line.\n   * @param {!Array<Cesium.Cartesian3>|Array<Array<Cesium.Cartesian3>>} positions The vertices of the line(s).\n   * @return {!Cesium.GroundPrimitive} primitive\n   */\n  createStackedGroundCorridors(layer, feature, width, color, positions) {\n    // Convert positions to an Array if it isn't\n    if (!Array.isArray(positions[0])) {\n      positions = [positions];\n    }\n    width = Math.max(3, width); // A <3px width is too small for ground primitives\n    const geometryInstances = [];\n    let previousDistance = 0;\n    // A stack of ground lines with increasing width (in meters) are created.\n    // Only one of these lines is displayed at any time giving a feeling of continuity.\n    // The values for the distance and width factor are more or less arbitrary.\n    // Applications can override this logics by subclassing the FeatureConverter class.\n    for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n      width *= 2.14;\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        width,\n        vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n      };\n      for (const linePositions of positions) {\n        geometryOptions.positions = linePositions;\n        geometryInstances.push(new Cesium.GeometryInstance({\n          geometry: new Cesium.CorridorGeometry(geometryOptions),\n          attributes: {\n            color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n            distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n          }\n        }));\n      }\n      previousDistance = distance;\n    }\n    return new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances\n    });\n  }\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olLineStringGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND && !isGroundPolylinePrimitiveSupported(this.scene)) {\n      const color = this.extractColorFromOlStyle(olStyle, true);\n      outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n    } else {\n      const appearance = new Cesium.PolylineMaterialAppearance({\n        // always update Cesium externs before adding a property\n        material: this.olStyleToCesium(feature, olStyle, true)\n      });\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        positions,\n        width,\n      };\n      const primitiveOptions = {\n        // always update Cesium externs before adding a property\n        appearance\n      };\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const geometry = new Cesium.GroundPolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n        outlinePrimitive.readyPromise.then(() => {\n          this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n        });\n      } else {\n        geometryOptions.vertexFormat = appearance.vertexFormat;\n        const geometry = new Cesium.PolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.Primitive(primitiveOptions);\n      }\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olPolygonGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry, outlinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.getGeometry().get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      // always update Cesium externs before adding a property\n      const hierarchy = {};\n      const polygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i == 0) {\n          hierarchy.positions = positions;\n        } else {\n          if (!hierarchy.holes) {\n            hierarchy.holes = [];\n          }\n          hierarchy.holes.push({\n            positions\n          });\n        }\n      }\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        // always update Cesium externs before adding a property\n        polygonHierarchy,\n        perPositionHeight: true\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n            const color = this.extractColorFromOlStyle(olStyle, true);\n            outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n          } else {\n            const appearance = new Cesium.PolylineMaterialAppearance({\n              // always update Cesium externs before adding a property\n              material: this.olStyleToCesium(feature, olStyle, true)\n            });\n            const geometryInstances = [];\n            for (const linePositions of positions) {\n              const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n              geometryInstances.push(new Cesium.GeometryInstance({\n                geometry: polylineGeometry\n              }));\n            }\n            const primitiveOptions = {\n              // always update Cesium externs before adding a property\n              appearance,\n              geometryInstances\n            };\n            outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n            outlinePrimitive.readyPromise.then(() => {\n              this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n            });\n          }\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          // always update Cesium externs before adding a property\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @return {!Cesium.HeightReference}\n   * @api\n   */\n  getHeightReference(layer, feature, geometry) {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      imageStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n\n    if (imageStyle instanceof olStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n        // always update Cesium externs before adding a property\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      });\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof olStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          bbOptions.pixelOffset = new Cesium.Cartesian2((image.width / 2 - anchor[0]) * scale, (image.height / 2 - anchor[1]) * scale);\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n      if (olcsModelFunction) {\n        const olcsModel = olcsModelFunction();\n        const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n        const model = Cesium.Model.fromGltf(options);\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        modelPrimitive.add(model);\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer,\n      feature,\n      geometry,\n      projection,\n      olStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    // FIXME: would be better to combine all child geometries in one primitive\n    // instead we create n primitives for simplicity.\n    const accumulate = function(geometries, functor) {\n      const primitives = new Cesium.PrimitiveCollection();\n      geometries.forEach((geometry) => {\n        primitives.add(functor(layer, feature, geometry, projection, olStyle));\n      });\n      return primitives;\n    };\n\n    let subgeos;\n    switch (geometry.getType()) {\n      case 'MultiPoint':\n        geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n        subgeos = geometry.getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            const result = this.olPointGeometryToCesium(layer, feature, geometry,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            this.olPointGeometryToCesium(layer, feature, geometry, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      case 'MultiLineString':\n        geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n        subgeos = geometry.getLineStrings();\n        return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n      case 'MultiPolygon':\n        geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n        subgeos = geometry.getPolygons();\n        return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Text} style\n   * @return {Cesium.LabelCollection} Cesium primitive\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer, feature, geometry, style) {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n    options.position = olcsCore.ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 && offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.style.Style} style\n   * @param {boolean} outline\n   * @return {Cesium.Material}\n   * @api\n   */\n  olStyleToCesium(feature, style, outline) {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    let color = outline ? stroke.getColor() : fill.getColor();\n    color = olcsCore.convertColorToCesium(color);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        // always update Cesium externs before adding a property\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        // always update Cesium externs before adding a property\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature\n   * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n   * @param {number} resolution\n   * @return {Array.<!ol.style.Style>} null if no style is available\n   * @api\n   */\n  computePlainStyle(layer, feature, fallbackStyleFunction, resolution) {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   * @protected\n   * @param {!ol.Feature} feature\n   * @param {!ol.style.Style} style\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {ol.geom.Geometry|undefined}\n   */\n  getGeometryFromFeature(feature, style, opt_geom) {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n    if (geom3d && geom3d instanceof olGeomGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof olGeomGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.style.Style} style\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olFeatureToCesium(layer, feature, style, context, opt_geom) {\n    let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n        // TODO: use getGeometriesArray() instead\n        collection.getGeometries().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        geom = /** @type {!ol.geom.Point} */ (geom);\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        geom = /** @type {!ol.geom.Circle} */ (geom);\n        return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'LineString':\n        geom = /** @type {!ol.geom.LineString} */ (geom);\n        return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'Polygon':\n        geom = /** @type {!ol.geom.Polygon} */ (geom);\n        return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'MultiPoint':\n      case 'MultiLineString':\n      case 'MultiPolygon':\n        const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n            style, context.billboards, newBillboardAddedCallback);\n        if (!result2) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result2;\n        }\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n   * @param {!ol.View} olView\n   * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n   * @return {!olcs.core.VectorLayerCounterpart}\n   * @api\n   */\n  olVectorLayerToCesium(olLayer, olView, featurePrimitiveMap) {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof olSourceVector);\n    const features = source.getFeatures();\n    const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      /**\n       * @type {ol.StyleFunction|undefined}\n       */\n      const layerStyle = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      /**\n       * @type {Cesium.Primitive|null}\n       */\n      let primitives = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n   * @param {!ol.View} view\n   * @param {!ol.Feature} feature\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @return {Cesium.Primitive}\n   * @api\n   */\n  convert(layer, view, feature, context) {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n\n\nexport default FeatureConverter;\n","import MVT from 'ol/format/MVT.js';\nimport Style from 'ol/style/Style.js';\nimport Stroke from 'ol/style/Stroke.js';\nimport {toContext} from 'ol/render.js';\nimport {get as getProjection} from 'ol/proj.js';\nimport {VERSION as OL_VERSION} from 'ol/util.js';\nimport LRUCache from 'ol/structs/LRUCache.js';\nimport {getForProjection as getTilegridForProjection} from 'ol/tilegrid.js';\nimport {createFromTemplates as createTileUrlFunctions} from 'ol/tileurlfunction.js';\n\n\nconst format = new MVT();\nconst styles = [new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n})];\n\n\nexport default class MVTImageryProvider {\n  constructor(options) {\n    this.urls = options.urls;\n    this.ready = true;\n    this.readyPromise = Promise.resolve(true);\n    this.tileWidth = 256;\n    this.tileHeight = 256;\n    this.maximumLevel = options.maximumLevel || 20;\n    this.minimumLevel = options.minimumLevel || 0;\n    this.tilingScheme = new Cesium.WebMercatorTilingScheme;\n    this.rectangle = options.rectangle || this.tilingScheme.rectangle;\n    this.errorEvent = new Cesium.Event();\n    this.credit = options.credit;\n    this.hasAlphaChannel = true;\n    this.styleFunction_ = options.styleFunction || (() => styles);\n    this.projection_ = getProjection('EPSG:3857');\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n    this.tileRectangle_ = new Cesium.Rectangle();\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 50;\n    this.tileCache = new LRUCache(cacheSize);\n    this.featureCache = options.featureCache || new LRUCache(cacheSize);\n    // to avoid too frequent cache grooming we allow x2 capacity\n\n    const tileGrid = getTilegridForProjection(this.projection_);\n    this.tileFunction_ = createTileUrlFunctions(this.urls, tileGrid);\n  }\n\n  getTileCredits() {\n    return [];\n  }\n\n  pickFeatures() {\n  }\n\n\n  getTileFeatures(z, x, y) {\n    const cacheKey = this.getCacheKey_(z, x, y);\n    let promise;\n    if (this.featureCache.containsKey(cacheKey)) {\n      promise = this.featureCache.get(cacheKey);\n    }\n    if (!promise) {\n      const url = this.getUrl_(z, x, y);\n      promise = fetch(url)\n          .then(r => (r.ok ? r : Promise.reject(r)))\n          .then(r => r.arrayBuffer())\n          .then(buffer => this.readFeaturesFromBuffer(buffer));\n      this.featureCache.set(cacheKey, promise);\n      if (this.featureCache.getCount() > 2 * this.featureCache.highWaterMark) {\n        while (this.featureCache.canExpireCache()) {\n          this.featureCache.pop();\n        }\n      }\n    }\n    return promise;\n  }\n\n  readFeaturesFromBuffer(buffer) {\n    let options;\n    if (OL_VERSION <= '6.4.4') {\n      // See https://github.com/openlayers/openlayers/pull/11540\n      options = {\n        extent: [0, 0, 4096, 4096],\n        dataProjection: format.dataProjection,\n        featureProjection: format.dataProjection\n      };\n    }\n    const features = format.readFeatures(buffer, options);\n    const scaleFactor = this.tileWidth / 4096;\n    features.forEach((f) => {\n      const flatCoordinates = f.getFlatCoordinates();\n      let flip = false;\n      for (let i = 0; i < flatCoordinates.length; ++i) {\n        flatCoordinates[i] *= scaleFactor;\n        if (flip) {\n          // FIXME: why do we need this now?\n          flatCoordinates[i] = this.tileWidth - flatCoordinates[i];\n        }\n        if (OL_VERSION <= '6.4.4') {\n          flip = !flip;\n        }\n      }\n    });\n\n    return features;\n  }\n\n  getUrl_(z, x, y) {\n    const url = this.tileFunction_([z, x, y]);\n    return url;\n  }\n\n  getCacheKey_(z, x, y) {\n    return `${z}_${x}_${y}`;\n  }\n\n  requestImage(x, y, z, request) {\n    if (z < this.minimumLevel) {\n      return this.emptyCanvas_;\n    }\n\n    try {\n      const cacheKey = this.getCacheKey_(z, x, y);\n      let promise;\n      if (this.tileCache.containsKey(cacheKey)) {\n        promise = this.tileCache.get(cacheKey);\n      }\n      if (!promise) {\n        promise = this.getTileFeatures(z, x, y)\n            .then((features) => {\n            // FIXME: here we suppose the 2D projection is in meters\n              this.tilingScheme.tileXYToNativeRectangle(x, y, z, this.tileRectangle_);\n              const resolution = (this.tileRectangle_.east - this.tileRectangle_.west) / this.tileWidth;\n              return this.rasterizeFeatures(features, this.styleFunction_, resolution);\n            });\n        this.tileCache.set(cacheKey, promise);\n        if (this.tileCache.getCount() > 2 * this.tileCache.highWaterMark) {\n          while (this.tileCache.canExpireCache()) {\n            this.tileCache.pop();\n          }\n        }\n      }\n      return promise;\n    } catch (e) {\n      console.trace(e);\n      this.raiseEvent('could not render pbf to tile', e);\n    }\n  }\n\n  rasterizeFeatures(features, styleFunction, resolution) {\n    const canvas = document.createElement('canvas');\n    const vectorContext = toContext(canvas.getContext('2d'), {size: [this.tileWidth, this.tileHeight]});\n    features.forEach((f) => {\n      const styles = styleFunction(f, resolution);\n      if (styles) {\n        styles.forEach((style) => {\n          vectorContext.setStyle(style);\n          vectorContext.drawGeometry(f);\n        });\n      }\n    });\n    return canvas;\n  }\n}\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsUtil from './util.js';\nimport olcsCore from './core.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer.js';\nimport olcsVectorSynchronizer from './VectorSynchronizer.js';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\n\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\n\n\nclass OLCesium {\n  /**\n   * @param {!OLCesiumOptions} options Options.\n   * @constructor\n   * @api\n   */\n  constructor(options) {\n\n    /**\n     * @type {olcs.AutoRenderLoop}\n     * @private\n     */\n    this.autoRenderLoop_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = options.map;\n\n    /**\n     * @type {!function(): Cesium.JulianDate}\n     * @private\n     */\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     * @private\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.resolutionScale_ = 1.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientWidth_ = 0.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientHeight_ = 0.0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.resolutionScaleChanged_ = true; // force resize\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;';\n\n    /**\n     * @type {!Element}\n     * @private\n     */\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     * @type {boolean}\n     * @private\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n\n    /**\n     * @type {!HTMLCanvasElement}\n     * @private\n     */\n    this.canvas_ = /** @type {!HTMLCanvasElement} */ (document.createElement('CANVAS'));\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (olcsUtil.supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = olcsUtil.imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() { return false; };\n    this.canvas_.onselectstart = function() { return false; };\n\n    this.container_.appendChild(this.canvas_);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.enabled_ = false;\n\n    /**\n     * @type {!Array.<ol.interaction.Interaction>}\n     * @private\n     */\n    this.pausedInteractions_ = [];\n\n    /**\n     * @type {?ol.layer.Group}\n     * @private\n     */\n    this.hiddenRootGroup_ = null;\n\n    const sceneOptions = options.sceneOptions !== undefined ? options.sceneOptions :\n      /** @type {Cesium.SceneOptions} */ ({});\n    sceneOptions.canvas = this.canvas_;\n    sceneOptions.scene3DOnly = true;\n\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.SHIFT\n    });\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.ALT\n    });\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    /**\n     * @type {!olcs.Camera}\n     * @private\n     */\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    /**\n     * @type {!Cesium.Globe}\n     * @private\n     */\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    const synchronizers = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = synchronizers.length - 1; i >= 0; --i) {\n      synchronizers[i].synchronize();\n    }\n\n    /**\n     * Time of the last rendered frame, as returned by `performance.now()`.\n     * @type {number}\n     * @private\n     */\n    this.lastFrameTime_ = 0;\n\n    /**\n     * The identifier returned by `requestAnimationFrame`.\n     * @type {number|undefined}\n     * @private\n     */\n    this.renderId_ = undefined;\n\n    /**\n     * Target frame rate for the render loop.\n     * @type {number}\n     * @private\n     */\n    this.targetFrameRate_ = Number.POSITIVE_INFINITY;\n\n    /**\n     * If the Cesium render loop is being blocked.\n     * @type {boolean}\n     * @private\n     */\n    this.blockCesiumRendering_ = false;\n\n    /**\n     * If the warmup routine is active.\n     * @type {boolean}\n     * @private\n     */\n    this.warmingUp_ = false;\n\n    /**\n     * @type {ol.Feature}\n     * @private\n     */\n    this.trackedFeature_ = null;\n\n    /**\n     * @type {Cesium.Entity}\n     * @private\n     */\n    this.trackedEntity_ = null;\n\n    /**\n     * @type {Cesium.EntityView}\n     * @private\n     */\n    this.entityView_ = null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.needTrackedEntityUpdate_ = false;\n\n    /**\n     * @type {!Cesium.BoundingSphere}\n     */\n    this.boundingSphereScratch_ = new Cesium.BoundingSphere();\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n\n    // Cesium has a mechanism to prevent the camera to go under the terrain.\n    // Unfortunately, it is only active when all the terrain has been loaded, which:\n    // - does not prevent the camera to sink under terrain anymore;\n    // - introduce a jumping effect once all terrain has been loaded and the position of the camera is finally fixed.\n    // The property below enables a workaround found in the Camptocamp Cesium fork.\n    // See also https://github.com/AnalyticalGraphicsInc/cesium/issues/5999.\n    Cesium.Camera.enableSuspendTerrainAdjustment = false;\n  }\n\n  /**\n   * Render the Cesium scene.\n   * @private\n   */\n  render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   * @private\n   */\n  onAnimationFrame_(frameTime) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === Cesium.BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  /**\n   * @private\n   */\n  updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === Cesium.BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== Cesium.BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  /**\n   * @private\n   */\n  handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 | height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!olcsUtil.supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    this.scene_.camera.frustum.aspectRatio = width / height;\n  }\n\n  /**\n   * @return {!olcs.Camera}\n   * @api\n   */\n  getCamera() {\n    return this.camera_;\n  }\n\n  /**\n   * @return {!ol.Map}\n   * @api\n   */\n  getOlMap() {\n    return this.map_;\n  }\n\n  /**\n   * @return {!ol.View}\n   * @api\n   */\n  getOlView() {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @return {!Cesium.Scene}\n   * @api\n   */\n  getCesiumScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceCollection}\n   * @api\n   */\n  getDataSources() {\n    return this.dataSourceCollection_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceDisplay}\n   * @api\n   */\n  getDataSourceDisplay() {\n    return this.dataSourceDisplay_;\n  }\n\n  /**\n   * @return {boolean}\n   * @api\n   */\n  getEnabled() {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   * @param {boolean} enable\n   * @api\n   */\n  setEnabled(enable) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = interaction =>\n          this.pausedInteractions_ = this.pausedInteractions_.filter(i => i !== interaction);\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n   * @api\n  */\n  warmUp(height, timeout) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n   * @api\n  */\n  setBlockCesiumRendering(block) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   * @api\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n   * @return {?olcs.AutoRenderLoop}\n   * @api\n  */\n  getAutoRenderLoop() {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   *\n   * @param {number} value\n   * @this {olcs.OLCesium}\n   * @api\n   */\n  setResolutionScale(value) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   * @api\n   */\n  setTargetFrameRate(value) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   * @private\n   */\n  throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  /**\n   * @type {ol.Feature}\n   */\n  get trackedFeature() {\n    return this.trackedFeature_;\n  }\n\n  /**\n   * @param {ol.Feature} feature\n   */\n  set trackedFeature(feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry.getCoordinates();\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return olcsCore.ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independant from the primitive/geometry created by the vector synchronizer.\n      const options = {\n        'position': new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        'point': {\n          'pixelSize': 1,\n          'color': Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n\nexport default OLCesium;\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport {getUid} from './util.js';\n\nclass OverlaySynchronizer {\n  /**\n  * @param {!ol.Map} map\n  * @param {!Cesium.Scene} scene\n  * @constructor\n  * @template T\n  * @api\n  */\n  constructor(map, scene) {\n    /**\n    * @type {!ol.Map}\n    * @protected\n    */\n    this.map = map;\n\n    /**\n    * @type {ol.Collection.<ol.Overlay>}\n    * @private\n    */\n    this.overlays_ = this.map.getOverlays();\n\n    /**\n    * @type {!Cesium.Scene}\n    * @protected\n    */\n    this.scene = scene;\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n    overlayEvents.forEach((event) => {\n      this.overlayContainerStopEvent_.addEventListener(event, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainer_ = document.createElement('DIV');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n    /**\n    * @type {!Object<?,olcs.SynchronizedOverlay>}\n    * @private\n    */\n    this.overlayMap_ = {};\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return {!Element} The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return {!Element} The map's overlay container.\n  */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.addOverlays();\n    this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n    this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  addOverlayFromEvent_(event) {\n    const overlay = /** @type {ol.Overlay} */ (event.element);\n    this.addOverlay(overlay);\n  }\n\n  /**\n  * @api\n  */\n  addOverlays() {\n    this.overlays_.forEach((overlay) => { this.addOverlay(overlay); });\n  }\n\n  /**\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  addOverlay(overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new olcsSynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    const overlayId = getUid(overlay).toString();\n    this.overlayMap_[overlayId] = cesiumOverlay;\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  removeOverlayFromEvent_(event) {\n    const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n    this.removeOverlay(removedOverlay);\n  }\n\n  /**\n  * Removes an overlay from the scene\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  removeOverlay(overlay) {\n    const overlayId = getUid(overlay).toString();\n    const csOverlay = this.overlayMap_[overlayId];\n    if (csOverlay) {\n      csOverlay.destroy();\n      delete this.overlayMap_[overlayId];\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  * @protected\n  */\n  destroyAll() {\n    Object.keys(this.overlayMap_).forEach((key) => {\n      const overlay = this.overlayMap_[key];\n      overlay.destroy();\n      delete this.overlayMap_[key];\n    });\n  }\n}\n\n\nexport default OverlaySynchronizer;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {getUid, stableSort} from './util.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsCore from './core.js';\n\nclass RasterSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @constructor\n   * @extends {olcsAbstractSynchronizer.<Cesium.ImageryLayer>}\n   * @api\n   */\n  constructor(map, scene) {\n    super(map, scene);\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.cesiumLayers_ = scene.imageryLayers;\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(object) {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   * @param {!ol.layer.Base} olLayer\n   * @param {!ol.proj.Projection} viewProj Projection of the view.\n   * @return {?Array.<!Cesium.ImageryLayer>} array or null if not possible\n   * (or supported)\n   * @protected\n   */\n  convertLayerToCesiumImageries(olLayer, viewProj) {\n    const result = olcsCore.tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer.getStyleFunction) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            if (csObj._imageryCache && csObj.imageryProvider.cache_) {\n              csObj._imageryCache = {};\n              csObj.imageryProvider.cache_ = {};\n              csObj.imageryProvider.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices = {};\n    const queue = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof olLayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    stableSort(layers, (layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  /**\n   * @param {Cesium.ImageryLayer} counterpart\n   */\n  raiseToTop(counterpart) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n\n\nexport default RasterSynchronizer;\n","/**\n * @module olcs.SynchronizedOverlay\n */\nimport olOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {removeNode, removeChildren} from './util.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Options for SynchronizedOverlay\n * @typedef {Object} SynchronizedOverlayOptions\n * @property {!Cesium.Scene} scene\n * @property {olOverlay} parent\n * @property {!import('olsc/OverlaySynchronizer.js').default} synchronizer\n */\n\n\nclass SynchronizedOverlay extends olOverlay {\n  /**\n   * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options) {\n    const parent = options.parent;\n    super(parent.getOptions());\n\n    /**\n     * @private\n     * @type {?Function}\n     */\n    this.scenePostRenderListenerRemover_ = null;\n\n    /**\n     * @private\n     * @type {!Cesium.Scene}\n     */\n    this.scene_ = options.scene;\n\n    /**\n     * @private\n     * @type {!olcs.OverlaySynchronizer}\n     */\n    this.synchronizer_ = options.synchronizer;\n\n    /**\n     * @private\n     * @type {!ol.Overlay}\n     */\n    this.parent_ = parent;\n\n    /**\n     * @private\n     * @type {ol.Coordinate|undefined}\n     */\n    this.positionWGS84_ = undefined;\n\n    /**\n     * @private\n     * @type {MutationObserver}\n     */\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n\n    /**\n     * @private\n     * @type {Array.<MutationObserver>}\n     */\n    this.attributeObserver_ = [];\n\n    /**\n     * @private\n     * @type {Array<ol.EventsKey>}\n     */\n    this.listenerKeys_ = [];\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = event => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param {Node} target\n   * @private\n   */\n  observeTarget_(target) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {ol.Object.Event} event\n   * @private\n   */\n  setPropertyFromEvent_(event) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return {!Cesium.Scene} The scene that the overlay is part of.\n   * @api\n   */\n  getScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    function cloneNode(node, parent) {\n      const clone = node.cloneNode();\n      if (node.nodeName === 'CANVAS') {\n        const ctx = clone.getContext('2d');\n        ctx.drawImage(node, 0, 0);\n      }\n      if (parent) {\n        parent.appendChild(clone);\n      }\n      if (node.nodeType != Node.TEXT_NODE) {\n        clone.addEventListener('click', (event) => {\n          node.dispatchEvent(new MouseEvent('click', event));\n          event.stopPropagation();\n        });\n      }\n      const nodes = node.childNodes;\n      for (let i = 0; i < nodes.length; i++) {\n        if (!nodes[i]) {\n          continue;\n        }\n        cloneNode(nodes[i], clone);\n      }\n      return clone;\n    }\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of element.parentNode.childNodes) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if (this.element.removeNode) {\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n\nexport default SynchronizedOverlay;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {olcsListen, getUid} from './util.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsFeatureConverter from './FeatureConverter.js';\n\nclass VectorSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @param {olcs.FeatureConverter=} opt_converter\n   * @extends {olcs.AbstractSynchronizer.<olcs.core.VectorLayerCounterpart>}\n   * @api\n   */\n  constructor(map, scene, opt_converter) {\n    super(map, scene);\n\n    /**\n     * @protected\n     */\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n\n    /**\n     * @private\n     */\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(counterpart) {\n    console.assert(counterpart);\n    counterpart.getRootPrimitive()['counterpart'] = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.getRootPrimitive().destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   * @param {import('olsc/core.js').LayerWithParents} olLayerWithParents\n   * @param {!Cesium.Primitive} csPrimitive\n   */\n  updateLayerVisibility(olLayerWithParents, csPrimitive) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible &= layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap = {};\n    const counterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n        featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olcsListen(olLayerItem, 'change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (function(feature) {\n      console.assert(\n          (olLayer instanceof olLayerVector) ||\n          (olLayer instanceof olLayerImage)\n      );\n      const context = counterpart.context;\n      const prim = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    }).bind(this);\n\n    const onRemoveFeature = (function(feature) {\n      const id = getUid(feature);\n      const context = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    }).bind(this);\n\n    olListenKeys.push(olcsListen(source, 'addfeature', (e) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'removefeature', (e) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'changefeature', (e) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }, this));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n\nexport default VectorSynchronizer;\n","/**\n * @module olcs.contrib.LazyLoader\n */\nexport default class LazyLoader {\n  /**\n   * @param {string} url\n   * @api\n   */\n  constructor(url) {\n    /**\n     * @type {Promise<undefined>}\n     * @protected\n     */\n    this.promise;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.url_ = url;\n  }\n\n  /**\n   * @return {Promise<undefined>}\n   * @api\n   */\n  load() {\n    if (!this.promise) {\n      // not yet loading\n      this.promise = new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.onload = () => resolve();\n        script.onerror = () => reject();\n        document.head.appendChild(script);\n        script.src = this.url_;\n      });\n    }\n    return this.promise;\n  }\n}\n","/**\n * @module olcs.contrib.Manager\n */\nimport olcsContribLazyLoader from '../contrib/LazyLoader.js';\nimport OLCesium from '../OLCesium.js';\nimport olcsCore from '../core.js';\nimport {toRadians} from '../math.js';\nimport olObservable from 'ol/Observable.js';\n\n\n/**\n * @typedef {Object} ManagerOptions\n * @property {import('ol/Map.js').default} map\n * @property {import('ol/extent.js').Extent} [cameraExtentInRadians]\n * @property {string} [cesiumIonDefaultAccessToken]\n */\n\n\nconst Manager = class extends olObservable {\n  /**\n   * @param {string} cesiumUrl\n   * @param {olcsx.contrib.ManagerOptions} options\n   * @api\n   */\n  constructor(cesiumUrl, {map, cameraExtentInRadians, cesiumIonDefaultAccessToken} = {}) {\n\n    super();\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumUrl_ = cesiumUrl;\n\n    /**\n     * @type {ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.Extent}\n     * @protected\n     */\n    this.cameraExtentInRadians = cameraExtentInRadians || null;\n\n    /**\n     * @private\n     * @type {Cesium.BoundingSphere}\n     */\n    this.boundingSphere_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.blockLimiter_ = false;\n\n    /**\n     * @type {Promise.<olcs.OLCesium>}\n     * @private\n     */\n    this.promise_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumIonDefaultAccessToken_ = cesiumIonDefaultAccessToken;\n\n    /**\n     * @type {olcs.OLCesium}\n     * @protected\n     */\n    this.ol3d;\n\n    /**\n     * @const {number} Tilt angle in radians\n     * @private\n     */\n    this.cesiumInitialTilt_ = toRadians(50);\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogDensity = 0.0001;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogSSEFactor = 25;\n\n    /**\n     * Limit the minimum distance to the terrain to 2m.\n     * @protected\n     * @type {number}\n     */\n    this.minimumZoomDistance = 2;\n\n    /**\n     * Limit the maximum distance to the earth to 10'000km.\n     * @protected\n     * @type {number}\n     */\n    this.maximumZoomDistance = 10000000;\n\n    // when closer to 3000m, restrict the available positions harder\n    /**\n     * @protected\n     * @param {number} height\n     */\n    this.limitCameraToBoundingSphereRatio = height => (height > 3000 ? 9 : 3);\n  }\n\n\n  /**\n   * @return {Promise.<olcs.OLCesium>}\n   */\n  load() {\n    if (!this.promise_) {\n      const cesiumLazyLoader = new olcsContribLazyLoader(this.cesiumUrl_);\n      this.promise_ = cesiumLazyLoader.load().then(() => this.onCesiumLoaded());\n    }\n    return this.promise_;\n  }\n\n\n  /**\n   * @protected\n   * @return {olcs.OLCesium}\n   */\n  onCesiumLoaded() {\n    if (this.cameraExtentInRadians) {\n      const rect = new Cesium.Rectangle(...this.cameraExtentInRadians);\n      // Set the fly home rectangle\n      Cesium.Camera.DEFAULT_VIEW_RECTANGLE = rect;\n      this.boundingSphere_ = Cesium.BoundingSphere.fromRectangle3D(rect, Cesium.Ellipsoid.WGS84, 300); // lux mean height is 300m\n    }\n\n    if (this.cesiumIonDefaultAccessToken_) {\n      Cesium.Ion.defaultAccessToken = this.cesiumIonDefaultAccessToken_;\n    }\n\n    this.ol3d = this.instantiateOLCesium();\n    const scene = this.ol3d.getCesiumScene();\n    this.configureForUsability(scene);\n    this.configureForPerformance(scene);\n    this.dispatchEvent('load');\n    return this.ol3d;\n  }\n\n\n  /**\n   * Application code should override this method.\n   * @return {olcs.OLCesium}\n   */\n  instantiateOLCesium() {\n    console.assert(this.map);\n    const ol3d = new OLCesium({map: this.map});\n    const scene = ol3d.getCesiumScene();\n    const terrainProvider = Cesium.createWorldTerrain();\n    scene.terrainProvider = terrainProvider;\n    return ol3d;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForPerformance(scene) {\n    const fog = scene.fog;\n    fog.enabled = true;\n    fog.density = this.fogDensity;\n    fog.screenSpaceErrorFactor = this.fogSSEFactor;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForUsability(scene) {\n    const sscController = scene.screenSpaceCameraController;\n    sscController.minimumZoomDistance = this.minimumZoomDistance;\n    sscController.maximumZoomDistance = this.maximumZoomDistance;\n\n    // Do not see through the terrain. Seeing through the terrain does not make\n    // sense anyway, except for debugging\n    scene.globe.depthTestAgainstTerrain = true;\n\n    // Use white instead of the black default colour for the globe when tiles are missing\n    scene.globe.baseColor = Cesium.Color.WHITE;\n    scene.backgroundColor = Cesium.Color.WHITE;\n\n    if (this.boundingSphere_) {\n      scene.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this), scene);\n    }\n    // Stop rendering Cesium when there is nothing to do. This drastically reduces CPU/GPU consumption.\n    this.ol3d.enableAutoRenderLoop();\n  }\n\n\n  /**\n   * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n   * Near the ground the allowed distance is shorter.\n   * @protected\n   */\n  limitCameraToBoundingSphere() {\n    if (this.boundingSphere_ && !this.blockLimiter_) {\n      const scene = this.ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const position = camera.position;\n      const carto = Cesium.Cartographic.fromCartesian(position);\n      const ratio = this.limitCameraToBoundingSphereRatio(carto.height);\n      if (Cesium.Cartesian3.distance(this.boundingSphere_.center, position) > this.boundingSphere_.radius * ratio) {\n        const currentlyFlying = camera.flying;\n        if (currentlyFlying === true) {\n          // There is a flying property and its value is true\n          return;\n        } else {\n          this.blockLimiter_ = true;\n          const unblockLimiter = () => this.blockLimiter_ = false;\n          camera.flyToBoundingSphere(this.boundingSphere_, {\n            complete: unblockLimiter,\n            cancel: unblockLimiter\n          });\n        }\n      }\n    }\n  }\n\n\n  /**\n   * Enable or disable ol3d with a default animation.\n   * @export\n   * @return {Promise<undefined>}\n   */\n  toggle3d() {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      if (is3DCurrentlyEnabled) {\n        // Disable 3D\n        console.assert(this.map);\n        return olcsCore.resetToNorthZenith(this.map, scene).then(() => {\n          ol3d.setEnabled(false);\n          this.dispatchEvent('toggle');\n        });\n      } else {\n        // Enable 3D\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n        return olcsCore.rotateAroundBottomCenter(scene, this.cesiumInitialTilt_);\n      }\n    });\n  }\n\n\n  /**\n   * Enable ol3d with a view built from parameters.\n   *\n   * @export\n   * @param {number} lon\n   * @param {number} lat\n   * @param {number} elevation\n   * @param {number} headingDeg Heading value in degrees.\n   * @param {number} pitchDeg Pitch value in degrees.\n   * @returns {Promise<undefined>}\n   */\n  set3dWithView(lon, lat, elevation, headingDeg, pitchDeg) {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const destination = Cesium.Cartesian3.fromDegrees(lon, lat, elevation);\n      const heading = Cesium.Math.toRadians(headingDeg);\n      const pitch = Cesium.Math.toRadians(pitchDeg);\n      const roll = 0;\n      const orientation = {heading, pitch, roll};\n\n      if (!is3DCurrentlyEnabled) {\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n      }\n\n      camera.setView({\n        destination,\n        orientation\n      });\n    });\n  }\n\n\n  /**\n   * @export\n   * @return {boolean}\n   */\n  is3dEnabled() {\n    return !!this.ol3d && this.ol3d.getEnabled();\n  }\n\n\n  /**\n   * @return {number}\n   */\n  getHeading() {\n    return this.map ? this.map.getView().getRotation() || 0 : 0;\n  }\n\n\n  /**\n   * @return {number|undefined}\n   */\n  getTiltOnGlobe() {\n    const scene = this.ol3d.getCesiumScene();\n    const tiltOnGlobe = olcsCore.computeSignedTiltAngleOnGlobe(scene);\n    return -tiltOnGlobe;\n  }\n\n\n  /**\n   * @param {number} angle\n   */\n  setHeading(angle) {\n    const scene = this.ol3d.getCesiumScene();\n    const bottom = olcsCore.pickBottomPoint(scene);\n    if (bottom) {\n      olcsCore.setHeadingUsingBottomCenter(scene, angle, bottom);\n    }\n  }\n\n  /**\n   * @export\n   * @return {olcs.OLCesium}\n   */\n  getOl3d() {\n    return this.ol3d;\n  }\n\n  /**\n   * @export\n   * @return {!ol.View}\n   */\n  getOlView() {\n    const view = this.map.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @export\n   * @return {Cesium.Matrix4}\n   */\n  getCesiumViewMatrix() {\n    return this.ol3d.getCesiumScene().camera.viewMatrix;\n  }\n\n  /**\n   * @export\n   * @return {!Cesium.Scene}\n   */\n  getCesiumScene() {\n    return this.ol3d.getCesiumScene();\n  }\n\n  /**\n   * @export\n   * @param {!Cesium.Rectangle} rectangle\n   * @param {number=} offset in meters\n   * @return {Promise<undefined>}\n   */\n  flyToRectangle(rectangle, offset = 0) {\n    const camera = this.getCesiumScene().camera;\n    const destination = camera.getRectangleCameraCoordinates(rectangle);\n\n    const mag = Cesium.Cartesian3.magnitude(destination) + offset;\n    Cesium.Cartesian3.normalize(destination, destination);\n    Cesium.Cartesian3.multiplyByScalar(destination, mag, destination);\n\n    return new Promise((resolve, reject) => {\n      if (!this.cameraExtentInRadians) {\n        reject();\n        return;\n      }\n\n      camera.flyTo({\n        destination,\n        complete: () => resolve(),\n        cancel: () => reject(),\n        endTransform: Cesium.Matrix4.IDENTITY\n      });\n    });\n  }\n\n  /**\n   * @protected\n   * @return {Cesium.Rectangle|undefined}\n   */\n  getCameraExtentRectangle() {\n    if (this.cameraExtentInRadians) {\n      return new Cesium.Rectangle(...this.cameraExtentInRadians);\n    }\n  }\n};\n\n\nexport default Manager;\n","/**\n * @module olcs.core\n */\nimport {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceVectorTile from 'ol/source/VectorTile.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider.js';\nimport olcsUtil from './util.js';\nimport MVTImageryProvider from './MVTImageryProvider.js';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport {getCenter as getExtentCenter} from 'ol/extent';\n\nconst exports = {};\n\n\n/**\n * @typedef {Object} CesiumUrlDefinition\n * @property {string} url\n * @property {string} subdomains\n */\n\n\n/**\n * Options for rotate around axis core function.\n * @typedef {Object} RotateAroundAxisOption\n * @property {number} [duration]\n * @property {function(number): number} [easing]\n * @property {function(): void} [callback]\n */\n\n\n\n/**\n * @typedef {Object} LayerWithParents\n * @property {import('ol/layer/Base.js').default} layer\n * @property {Array<import('ol/layer/Group.js').default>} parents\n */\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @return {!Cesium.Cartesian2} the pixel size\n * @api\n */\nexports.computePixelSizeAtCoordinate = function(scene, target) {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight,\n      distance, scene.pixelRatio, new Cesium.Cartesian2());\n};\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexports.computeBoundingBoxAtTarget = function(scene, target, amount) {\n  const pixelSize = exports.computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n};\n\n\n/**\n *\n * @param {!ol.geom.Geometry} geometry\n * @param {number} height\n * @api\n */\nexports.applyHeightOffsetToGeometry = function(geometry, height) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n};\n\n\n/**\n * @param {ol.Coordinate} coordinates\n * @param {number=} rotation\n * @param {!Cesium.Cartesian3=} translation\n * @param {!Cesium.Cartesian3=} scale\n * @return {!Cesium.Matrix4}\n * @api\n */\nexports.createMatrixAtCoordinates = function(coordinates, rotation = 0, translation = Cesium.Cartesian3.ZERO, scale = new Cesium.Cartesian3(1, 1, 1)) {\n  const position = exports.ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n};\n\n\n/**\n * @param {!Cesium.Camera} camera\n * @param {number} angle\n * @param {!Cesium.Cartesian3} axis\n * @param {!Cesium.Matrix4} transform\n * @param {RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.rotateAroundAxis = function(camera, angle, axis, transform,\n    opt_options) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options = opt_options || {};\n  const duration = defaultValue(options.duration, 500); // ms\n  const easing = defaultValue(options.easing, linearEasing);\n  const callback = options.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} heading\n * @param {!Cesium.Cartesian3} bottomCenter\n * @param {RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.setHeadingUsingBottomCenter = function(scene, heading,\n    bottomCenter, opt_options) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = exports.computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  const rotateAroundAxis = exports.rotateAroundAxis;\n  rotateAroundAxis(camera, heading, zenith, transform, opt_options);\n};\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian2} pixel\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickOnTerrainOrEllipsoid = function(scene, pixel) {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n};\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickBottomPoint = function(scene) {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return exports.pickOnTerrainOrEllipsoid(scene, bottom);\n};\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickCenterPoint = function(scene) {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return exports.pickOnTerrainOrEllipsoid(scene, center);\n};\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n * intersection of the camera direction with the globe.\n * @param {!Cesium.Scene} scene\n * @return {number|undefined}\n * @api\n */\nexports.computeSignedTiltAngleOnGlobe = function(scene) {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = exports.signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n};\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Ray}\n */\nexports.bottomFovRay = function(scene) {\n  const camera = scene.camera;\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n};\n\n\n/**\n * Compute the angle between two Cartesian3.\n * @param {!Cesium.Cartesian3} first\n * @param {!Cesium.Cartesian3} second\n * @param {!Cesium.Cartesian3} normal Normal to test orientation against.\n * @return {number}\n */\nexports.signedAngleBetween = function(first, second, normal) {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n};\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} pivot Point around which the camera rotates.\n * @return {number}\n * @api\n */\nexports.computeAngleToZenith = function(scene, pivot) {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  const fy = camera.frustum.fovy / 2;\n  const ray = exports.bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = exports.signedAngleBetween(normal, direction, left);\n  return a + fy;\n};\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n * @api\n */\nexports.extentToRectangle = function(extent, projection) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @param {!ol.Map} olMap\n * @param {!ol.source.Source} source\n * @param {!ol.View} viewProj\n * @param {!ol.layer.Base} olLayer\n * @return {!Cesium.ImageryProvider}\n */\nexports.sourceToImageryProvider = function(olMap, source, viewProj, olLayer) {\n  const skip = source.get('olcs_skip');\n  if (skip) {\n    return null;\n  }\n  let provider = null;\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n    source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (exports.isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = olcsUtil.getSourceProjection(source);\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (exports.isCesiumProjection(projection)) {\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle: new Cesium.Rectangle.fromDegrees(\n            source.getImageExtent()[0],\n            source.getImageExtent()[1],\n            source.getImageExtent()[2],\n            source.getImageExtent()[3]\n        )\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceVectorTile) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (skip === false) {\n      // MVT is experimental, it should be whitelisted to be synchronized\n      const fromCode = projection.getCode().split(':')[1];\n      const urls = source.urls.map(u => u.replace(fromCode, '3857'));\n      const extent = olLayer.getExtent();\n      const rectangle = exports.extentToRectangle(extent, projection);\n      const minimumLevel = source.get('olcs_minimumLevel');\n      const attributionsFunction = source.getAttributions();\n      const styleFunction = olLayer.getStyleFunction();\n      let credit;\n      if (extent && attributionsFunction) {\n        const center = getExtentCenter(extent);\n        credit = attributionsFunctionToCredits(attributionsFunction, 0, center, extent)[0];\n      }\n\n      provider = new MVTImageryProvider({\n        credit,\n        rectangle,\n        minimumLevel,\n        styleFunction,\n        urls\n      });\n      return provider;\n    }\n    return null; // FIXME: it is disabled by default right now\n  } else {\n    // sources other than TileImage|ImageStatic are currently not supported\n    return null;\n  }\n  return provider;\n};\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and static images\n * @param {!ol.Map} olMap\n * @param {!ol.layer.Base} olLayer\n * @param {!ol.proj.Projection} viewProj Projection of the view.\n * @return {?Cesium.ImageryLayer} null if not possible (or supported)\n * @api\n */\nexports.tileLayerToImageryLayer = function(olMap, olLayer, viewProj) {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage) &&\n    !(olLayer instanceof VectorTileLayer)) {\n    return null;\n  }\n\n  const source = olLayer.getSource();\n  if (!source) {\n    return null;\n  }\n  let provider = source.get('olcs_provider');\n  if (!provider) {\n    provider = this.sourceToImageryProvider(olMap, source, viewProj, olLayer);\n  }\n  if (!provider) {\n    return null;\n  }\n\n  const layerOptions = {};\n\n  const forcedExtent = /** @type {ol.Extent} */ (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = exports.extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n};\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n * @param {olcsx.LayerWithParents} olLayerWithParents\n * @param {!Cesium.ImageryLayer} csLayer\n * @api\n */\nexports.updateCesiumLayerProperties = function(olLayerWithParents, csLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible &= layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n};\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n * @param {ol.Coordinate} coordinate Ol3 coordinate.\n * @return {!Cesium.Cartesian3} Cesium cartesian coordinate\n * @api\n */\nexports.ol4326CoordinateToCesiumCartesian = function(coordinate) {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n};\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n * @param {Array.<!ol.Coordinate>} coordinates Ol3 coordinates.\n * @return {!Array.<Cesium.Cartesian3>} Cesium cartesian coordinates\n * @api\n */\nexports.ol4326CoordinateArrayToCsCartesians = function(coordinates) {\n  console.assert(coordinates !== null);\n  const toCartesian = exports.ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n};\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n * @param {!T} geometry\n * @param {!ol.ProjectionLike} projection\n * @return {!T}\n * @template T\n * @api\n */\nexports.olGeometryCloneTo4326 = function(geometry, projection) {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj.getCode() !== proj4326.getCode()) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone();\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n};\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n * @param {ol.Color|CanvasGradient|CanvasPattern|string} olColor\n * @return {!Cesium.Color}\n * @api\n */\nexports.convertColorToCesium = function(olColor) {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n};\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n * @param {string} url\n * @return {!CesiumUrlDefinition}\n * @api\n */\nexports.convertUrlToCesium = function(url) {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n};\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @return {Promise<undefined>}\n * @api\n */\nexports.resetToNorthZenith = function(map, scene) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = exports.computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    exports.setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options = {\n      callback: () => {\n        const view = map.getView();\n        exports.normalizeView(view);\n        resolve();\n      }\n    };\n    exports.rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexports.rotateAroundBottomCenter = function(scene, angle) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options = {callback: resolve};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const rotateAroundAxis = exports.rotateAroundAxis;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n * @param {ol.View} view\n * @param {number=} angle\n * @api\n */\nexports.normalizeView = function(view, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n  if (view.constrainResolution) {\n    view.setResolution(view.constrainResolution(resolution));\n  } else {\n    view.setResolution(view.getConstrainedResolution(resolution));\n  }\n};\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n *\n * @param {ol.proj.Projection} projection Projection to check.\n * @returns {boolean} Whether it's managed by Cesium.\n */\nexports.isCesiumProjection = function(projection) {\n  const is3857 = projection.getCode() === 'EPSG:3857';\n  const is4326 = projection.getCode() === 'EPSG:4326';\n  return is3857 || is4326;\n};\n\n\nexport function attributionsFunctionToCredits(attributionsFunction, zoom, center, extent) {\n  const frameState = {\n    viewState: {zoom, center},\n    extent,\n  };\n\n  if (!attributionsFunction) {\n    return [];\n  }\n  let attributions = attributionsFunction(frameState);\n  if (!Array.isArray(attributions)) {\n    attributions = [attributions];\n  }\n\n  return attributions.map(html => new Cesium.Credit(html, true));\n}\n\nexport default exports;\n\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n * @param {number} resolution Number of map units per pixel.\n * @param {number} latitude Latitude in radians.\n * @param {import('cesium').Scene} scene.\n * @param {import('ol/proj/Projection').default} projection View projection.\n * @return {number} The calculated distance.\n * @api\n */\nexport function calcDistanceForResolution(resolution, latitude, scene, projection) {\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n}\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n * @param {number} distance\n * @param {number} latitude\n * @param {import('cesium').Scene} scene.\n * @param {import('ol/proj/Projection').default} projection View projection.\n * @return {number} The calculated resolution.\n * @api\n */\nexport function calcResolutionForDistance(distance, latitude, scene, projection) {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n}\n","/**\n * @module olcs.core.OLImageryProvider\n */\nimport olcsUtil from '../util.js';\nimport {Tile as TileSource} from 'ol/source.js';\nimport {attributionsFunctionToCredits} from '../core.js';\n\n\nconst olUseNewCoordinates = (function() {\n  const tileSource = new TileSource({\n    projection: 'EPSG:3857',\n    wrapX: true\n  });\n  const tileCoord = tileSource.getTileCoordForTileUrlFunction([6, -31, 22]);\n  return tileCoord && tileCoord[1] === 33 && tileCoord[2] === 22;\n  // See b/test/spec/ol/source/tile.test.js\n  // of e9a30c5cb7e3721d9370025fbe5472c322847b35 in OpenLayers repository\n})();\n\n\nclass OLImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param {!ol.Map} olMap\n   * @param {!ol.source.TileImage} source\n   * @param {ol.proj.Projection=} opt_fallbackProj Projection to assume if the\n   *                                               projection of the source is not defined.\n   * @constructor\n   * @extends {Cesium.ImageryProvider}\n   */\n  constructor(olMap, source, opt_fallbackProj) {\n    // Do not extend or call super constructor from\n    // Cesium.ImageryProvider since this particular function is a\n    // 'non instanciable interface' which throws on instanciation.\n\n    /**\n     * @type {!ol.source.TileImage}\n     * @private\n     */\n    this.source_ = source;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.projection_ = null;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.ready_ = false;\n\n    /**\n     * @type {?Cesium.TilingScheme}\n     * @private\n     */\n    this.tilingScheme_ = null;\n\n    /**\n     * @type {?Cesium.Rectangle}\n     * @private\n     */\n    this.rectangle_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = olMap;\n\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.shouldRequestNextLevel = false;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        this.proxy_ = {\n          'getURL': proxy\n        };\n      } else if (typeof proxy === 'string') {\n        this.proxy_ = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.errorEvent_ = new Cesium.Event();\n\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   * @private\n   */\n  handleSourceChanged_(frameState) {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = olcsUtil.getSourceProjection(this.source_) || this.fallbackProj_;\n      const options = {numberOfLevelZeroTilesX: 1, numberOfLevelZeroTilesY: 1};\n\n      if (this.source_.tileGrid !== null) {\n        // Get the number of tiles at level 0 if it is defined\n        this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(), 0, ([zoom, xIndex, yIndex]) => {\n          options.numberOfLevelZeroTilesX = xIndex + 1;\n          options.numberOfLevelZeroTilesY = yIndex + 1;\n        });\n      }\n\n      if (this.projection_.getCode() === 'EPSG:4326') {\n        // Cesium zoom level 0 is OpenLayers zoom level 1 for layer in EPSG:4326 with a single tile on level 0\n        this.shouldRequestNextLevel = options.numberOfLevelZeroTilesX === 1 && options.numberOfLevelZeroTilesY === 1;\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme(options);\n      } else if (this.projection_.getCode() === 'EPSG:3857') {\n        this.shouldRequestNextLevel = false;\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(options);\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @export\n   * @override\n   */\n  getTileCredits(x, y, level) {\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.shouldRequestNextLevel ? level + 1 : level;\n    return attributionsFunctionToCredits(attributionsFunction, zoom, center, extent);\n  }\n\n  /**\n   * @export\n   * @override\n   */\n  requestImage(x, y, level) {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n\n      const z_ = this.shouldRequestNextLevel ? level + 1 : level;\n\n      let y_ = y;\n      if (!olUseNewCoordinates) {\n        // OpenLayers version 3 to 5 tile coordinates increase from bottom to top\n        y_ = -y - 1;\n      }\n      let url = tileUrlFunction.call(this.source_, [z_, x, y_], 1, this.projection_);\n      if (this.proxy_) {\n        url = this.proxy_.getURL(url);\n      }\n      return url ? Cesium.ImageryProvider.loadImage(this, url) : this.emptyCanvas_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvas_;\n    }\n  }\n}\n\n// definitions of getters that are required to be present\n// in the Cesium.ImageryProvider instance:\nObject.defineProperties(OLImageryProvider.prototype, {\n  'ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  'rectangle': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.rectangle_;}\n  },\n\n  'tileWidth': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[0] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'tileHeight': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[1] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'maximumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? tg.getMaxZoom() : 18;\n        }\n  },\n\n  'minimumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          // WARNING: Do not use the minimum level (at least until the extent is\n          // properly set). Cesium assumes the minimumLevel to contain only\n          // a few tiles and tries to load them all at once -- this can\n          // freeze and/or crash the browser !\n          return 0;\n          //var tg = this.source_.getTileGrid();\n          //return tg ? tg.getMinZoom() : 0;\n        }\n  },\n\n  'tilingScheme': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.tilingScheme_;}\n  },\n\n  'tileDiscardPolicy': {\n    'get': function() {return undefined;}\n  },\n\n  'errorEvent': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.errorEvent_;}\n  },\n\n  'proxy': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.proxy_;}\n  },\n\n  'hasAlphaChannel': {\n    'get': function() {return true;}\n  },\n\n  'pickFeatures': {\n    'get': function() {return undefined;}\n  }\n});\n\n\nexport default OLImageryProvider;\n","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Context for feature conversion.\n * @typedef {Object} OlFeatureToCesiumContext\n * @property {!(import('ol/Projection.js').default|string)} projection\n * @property {!Cesium.PrimitiveCollection} primitives\n * @property {Object<number, Array<!Cesium.Primitive|!Cesium.Billboard>>} featureToCesiumMap\n * @property {!Cesium.BillboardCollection} billboards\n */\n\n\nclass VectorLayerCounterpart {\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  * @param {!(ol.proj.Projection|string)} layerProjection\n  * @param {!Cesium.Scene} scene\n  */\n  constructor(layerProjection, scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n\n    /**\n    * @type {!Array.<ol.EventsKey>}\n    */\n    this.olListenKeys = [];\n\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    /**\n    * @type {!OlFeatureToCesiumContext}\n    */\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  /**\n  * @return {!Cesium.Primitive}\n  */\n  getRootPrimitive() {\n    return this.rootCollection_;\n  }\n}\n\n\nexport default VectorLayerCounterpart;\n","/**\n * Converts radians to to degrees.\n *\n * @param {number} angleInRadians Angle in radians.\n * @return {number} Angle in degrees.\n */\nexport function toDegrees(angleInRadians) {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param {number} angleInDegrees Angle in degrees.\n * @return {number} Angle in radians.\n */\nexport function toRadians(angleInDegrees) {\n  return angleInDegrees * Math.PI / 180;\n}\n","/**\n * @module olcs.util\n */\nconst exports = {};\n\n\n/**\n * Cast to object.\n * @param {Object} param\n * @return {Object}\n */\nexports.obj = function(param) {\n  return param;\n};\n\n\n/**\n * @type {boolean|undefined}\n * @private\n */\nexports.supportsImageRenderingPixelatedResult_ = undefined;\n\n\n/**\n * @type {string|undefined}\n * @private\n */\nexports.imageRenderingValueResult_ = undefined;\n\n\n/**\n * @return {boolean}\n */\nexports.supportsImageRenderingPixelated = function() {\n  if (exports.supportsImageRenderingPixelatedResult_ === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const tmp = canvas.style['imageRendering']; // non standard\n    exports.supportsImageRenderingPixelatedResult_ = !!tmp;\n    if (exports.supportsImageRenderingPixelatedResult_) {\n      exports.imageRenderingValueResult_ = tmp;\n    }\n  }\n  return exports.supportsImageRenderingPixelatedResult_;\n};\n\n\n/**\n * @return {string}\n */\nexports.imageRenderingValue = function() {\n  exports.supportsImageRenderingPixelated();\n  return exports.imageRenderingValueResult_ || '';\n};\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param {ol.source.Source} source Source.\n * @returns {ol.proj.Projection} The projection of the source.\n */\nexports.getSourceProjection = function(source) {\n  return /** @type {ol.proj.Projection} */ (source.get('olcs.projection'))\n    || source.getProjection();\n};\n\n/**\n * @param {ol.Observable} observable\n * @param {string} type\n * @param {Function} listener\n * @return {!ol.events.EventsKey}\n */\nexport function olcsListen(observable, type, listener) {\n  // See https://github.com/openlayers/openlayers/pull/8481\n  // ol.events.listen is internal so we use `on` instead.\n  // And since `on` as a convoluted API (can return an EventsKey or an array of them)\n  // we use a cast here.\n  return /** @type {!ol.events.EventsKey} */ (observable.on(type, listener));\n}\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid.\n *\n * @param {Object} obj The object to get the unique ID for.\n * @return {number} The unique ID for the object.\n */\nexport function getUid(obj) {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\n/**\n * Sort the passed array such that the relative order of equal elements is preverved.\n * See https://en.wikipedia.org/wiki/Sorting_algorithm#Stability for details.\n * @param {Array<*>} arr The array to sort (modifies original).\n * @param {!function(*, *): number} compareFnc Comparison function.\n */\nexport function stableSort(arr, compareFnc) {\n  const length = arr.length;\n  const tmp = Array(arr.length);\n  for (let i = 0; i < length; i++) {\n    tmp[i] = {index: i, value: arr[i]};\n  }\n  tmp.sort((a, b) => compareFnc(a.value, b.value) || a.index - b.index);\n  for (let i = 0; i < arr.length; i++) {\n    arr[i] = tmp[i].value;\n  }\n}\n\n/**\n * @param {Node} node The node to remove.\n * @returns {Node} The node that was removed or null.\n */\nexport function removeNode(node) {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nexport function removeChildren(node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\n/**\n * @param {Cesium.Scene} scene The scene.\n */\nexport function isGroundPolylinePrimitiveSupported(scene) {\n  const obj = Cesium.GroundPolylinePrimitive;\n  return obj && obj.isSupported(scene);\n}\n\nexport default exports;\n","module.exports = ol.Observable;","module.exports = ol.Overlay;","module.exports = ol.easing;","module.exports = ol.extent;","module.exports = ol.format.MVT;","module.exports = ol.geom.Geometry;","module.exports = ol.geom.Point;","module.exports = ol.geom.Polygon;","module.exports = ol.geom.SimpleGeometry;","module.exports = ol.layer.Group;","module.exports = ol.layer.Image;","module.exports = ol.layer.Layer;","module.exports = ol.layer.Tile;","module.exports = ol.layer.Vector;","module.exports = ol.layer.VectorTile;","module.exports = ol.proj;","module.exports = ol.render;","module.exports = ol.source;","module.exports = ol.source.Cluster;","module.exports = ol.source.Image;","module.exports = ol.source.ImageStatic;","module.exports = ol.source.ImageWMS;","module.exports = ol.source.TileImage;","module.exports = ol.source.TileWMS;","module.exports = ol.source.Vector;","module.exports = ol.source.VectorTile;","module.exports = ol.structs.LRUCache;","module.exports = ol.style.Icon;","module.exports = ol.style.Stroke;","module.exports = ol.style.Style;","module.exports = ol.tilegrid;","module.exports = ol.tileurlfunction;","module.exports = ol.util;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import OLCesium from './olcs/OLCesium.js';\n\nimport AbstractSynchronizer from './olcs/AbstractSynchronizer.js';\nimport RasterSynchronizer from './olcs/RasterSynchronizer.js';\nimport VectorSynchronizer from './olcs/VectorSynchronizer.js';\n\nimport * as core from './olcs/core.js';\nimport OLImageryProvider from './olcs/core/OLImageryProvider.js';\nimport VectorLayerCounterpart from './olcs/core/VectorLayerCounterpart.js';\n\nimport LazyLoader from './olcs/contrib/LazyLoader.js';\nimport Manager from './olcs/contrib/Manager.js';\n\n\nexport default OLCesium;\n\n// Using var for phantomJS\n// eslint-disable-next-line no-var\nvar olcs = window['olcs'] = {};\nolcs.OLCesium = OLCesium;\n\nolcs.AbstractSynchronizer = AbstractSynchronizer;\nolcs.RasterSynchronizer = RasterSynchronizer;\nolcs.VectorSynchronizer = VectorSynchronizer;\n\nolcs.core = core.default;\nolcs.core.OLImageryProvider = OLImageryProvider;\nolcs.core.VectorLayerCounterpart = VectorLayerCounterpart;\n\nolcs.contrib = {};\nolcs.contrib.LazyLoader = LazyLoader;\nolcs.contrib.Manager = Manager;\n"],"names":["unByKey","olObservableUnByKey","olLayerGroup","olcsListen","getUid","AbstractSynchronizer","map","scene","view","getView","olLayers","getLayerGroup","getLayers","mapLayerGroup","layerMap","olLayerListenKeys","olGroupListenKeys_","synchronize","destroyAll","addLayers_","orderLayers","root","fifo","layer","parents","olLayerWithParents","splice","olLayer","olLayerId","toString","console","assert","cesiumObjects","listenForGroupChanges_","createSingleLayerCounterparts","forEach","l","newOlLayerWithParents","concat","push","layerId","layerWithParents","onLayerChange","e","cesiumObjs","un","addCesiumObjects_","length","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","unlistenSingleGroup_","group","keys","key","removeLayer_","done","uuid","undefined","listenKeyArray","contentKeys","listenAddRemove","collection","on","event","element","bind","el","i","indexOf","removeAllCesiumObjects","objKey","object","destroy","AutoRenderLoop","ol3d","scene_","getCesiumScene","canvas_","canvas","_boundNotifyRepaintRequired","notifyRepaintRequired","repaintEventNames_","enable","requestRenderMode","maximumRenderTimeChange","repaintKey","addEventListener","window","getOlMap","disable","removeEventListener","restartRenderLoop","requestRender","toRadians","toDegrees","getTransform","olcsCore","calcDistanceForResolution","calcResolutionForDistance","Camera","cam_","camera","map_","view_","viewListenKey_","toLonLat_","identityProjection","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","setView_","input","opt_output","opt_dimension","dim","toLonLat","getProjection","fromLonLat","handleViewEvent_","readFromView","setHeading","heading","setRotation","getHeading","rotation","getRotation","setTilt","tilt","updateCamera_","getTilt","setDistance","distance","updateView","getDistance","setCenter","center","getCenter","setPosition","position","ll","carto","Cesium","Cartographic","getAltitude","setView","destination","Ellipsoid","WGS84","cartographicToCartesian","getPosition","cartesianToCartographic","pos","longitude","latitude","setAltitude","altitude","height","globe","getHeight","orientation","pitch","Math","PI_OVER_TWO","roll","moveBackward","checkCameraChange","resolution","getResolution","ellipsoid","target","pickCenterPoint","bestTarget","positionCartographic","clone","Cartesian3","bestTargetCartographic","setResolution","targetNormal","geocentricSurfaceNormal","targetToCamera","subtract","normalize","up","right","normal","y","x","angleBetween","cross","z","tiltAngle","acos","dot","isNaN","PI","opt_dontSync","old","current","viewMatrix","Matrix4","equalsEpsilon","olGeomGeometry","olStyleIcon","olSourceVector","olSourceCluster","circular","olCreateCircularPolygon","boundingExtent","olGeomSimpleGeometry","olcsCoreVectorLayerCounterpart","olcsUtil","isGroundPolylinePrimitiveSupported","FeatureConverter","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","defaultBillboardEyeOffset_","evt","source","cancellers","obj","feature","id","canceller","hasOwnProperty","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","geometry","color","opt_lineWidth","createInstance","instance","GeometryInstance","ImageMaterialProperty","attributes","ColorGeometryInstanceAttribute","fromColor","options","flat","renderState","depthTest","enabled","lineWidth","instances","heightReference","getHeightReference","HeightReference","CLAMP_TO_GROUND","ctor","constructor","GroundPrimitive","geometryInstances","Primitive","dataUri","image","getValue","toDataURL","appearance","MaterialAppearance","material","Material","fabric","type","uniforms","PerInstanceColorAppearance","extractColorFromOlStyle","style","outline","fillColor","getFill","getColor","strokeColor","getStroke","olColor","convertColorToCesium","extractLineWidthFromOlStyle","width","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","primitives","PrimitiveCollection","p1","add","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","billboards","bbOptions","eyeOffset","bb","olCircleGeometryToCesium","projection","olGeometryCloneTo4326","getType","point","slice","getRadius","ol4326CoordinateToCesiumCartesian","radius","CircleGeometry","outlinePrimitive","circlePolygon","positions","ol4326CoordinateArrayToCsCartesians","getLinearRing","getCoordinates","createStackedGroundCorridors","GroundPolylinePrimitive","GroundPolylineGeometry","PolylineMaterialAppearance","olStyleToCesium","classificationType","ClassificationType","TERRAIN","readyPromise","then","_primitive","CircleOutlineGeometry","extrudedHeight","Array","isArray","max","previousDistance","geometryOptions","vertexFormat","VertexFormat","POSITION_ONLY","linePositions","CorridorGeometry","distanceDisplayCondition","DistanceDisplayConditionGeometryInstanceAttribute","olLineStringGeometryToCesium","primitiveOptions","PolylineGeometry","olPolygonGeometryToCesium","getGeometry","get","coordinates","extent","rectangle","Rectangle","fromDegrees","maxHeight","c","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","polygonHierarchy","olPos","holes","PolygonGeometry","perPositionHeight","polylineGeometry","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","load","getImage","isImageLoaded","src","naturalHeight","naturalWidth","complete","reallyCreateBillboard","HTMLCanvasElement","Image","HTMLImageElement","opacity","getOpacity","Color","scale","getScale","Object","assign","anchor","getAnchor","pixelOffset","Cartesian2","cancelled","getSource","fuid","listener","isDestroyed","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","cesiumOptions","model","Model","fromGltf","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","accumulate","geometries","functor","subgeos","getPoints","result","getLineStrings","getPolygons","labels","LabelCollection","extentCenter","getExtent","first","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","font","getFont","labelStyle","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","horizontalOrigin","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","verticalOrigin","VerticalOrigin","TOP","BOTTOM","fill","stroke","getLineDash","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getStyleFunction","getGeometryFromFeature","opt_geom","geom3d","geomFuncRes","getGeometryFunction","olFeatureToCesium","context","geom","proj","newBillboardAddedCallback","featureBb","featureToCesiumMap","getGeometries","prims","bbs","result2","Error","olVectorLayerToCesium","olView","featurePrimitiveMap","features","getFeatures","layerStyle","styles","prim","getRootPrimitive","convert","MVT","Style","Stroke","toContext","VERSION","OL_VERSION","LRUCache","getForProjection","getTilegridForProjection","createFromTemplates","createTileUrlFunctions","format","MVTImageryProvider","urls","ready","Promise","resolve","tileWidth","tileHeight","maximumLevel","minimumLevel","tilingScheme","WebMercatorTilingScheme","errorEvent","Event","credit","hasAlphaChannel","styleFunction_","styleFunction","projection_","emptyCanvas_","document","createElement","tileRectangle_","cacheSize","tileCache","featureCache","tileGrid","tileFunction_","getTileCredits","pickFeatures","getTileFeatures","cacheKey","getCacheKey_","promise","containsKey","url","getUrl_","fetch","r","ok","reject","arrayBuffer","buffer","readFeaturesFromBuffer","set","getCount","highWaterMark","canExpireCache","pop","dataProjection","featureProjection","readFeatures","scaleFactor","f","flatCoordinates","getFlatCoordinates","flip","requestImage","request","tileXYToNativeRectangle","east","west","rasterizeFeatures","trace","raiseEvent","vectorContext","getContext","size","setStyle","drawGeometry","olGeomPoint","olcsAutoRenderLoop","olcsCamera","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","OLCesium","autoRenderLoop_","time_","time","JulianDate","now","to4326Transform_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","fillArea","container_","containerAttribute","createAttribute","value","setAttributeNode","targetElement","getViewport","getElementById","appendChild","isOverMap_","stopOpenLayersEventsPropagation","overlayEvents","ii","stopPropagation","canvasAttribute","supportsImageRenderingPixelated","imageRenderingValue","oncontextmenu","onselectstart","enabled_","pausedInteractions_","hiddenRootGroup_","sceneOptions","scene3DOnly","Scene","sscc","screenSpaceCameraController","tiltEventTypes","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","constrainedAxis","UNIT_Z","camera_","globe_","Globe","baseColor","WHITE","skyAtmosphere","SkyAtmosphere","firstImageryProvider","SingleTileImageryProvider","imageryLayers","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers","createSynchronizers","handleResize_","lastFrameTime_","renderId_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","BoundingSphere","eventHelper","EventHelper","postRender","prototype","updateTrackedEntity_","enableSuspendTerrainAdjustment","render_","cancelAnimationFrame","requestAnimationFrame","onAnimationFrame_","frameTime","interval","delta","julianDate","initializeFrame","update","trackedEntity","trackedState","getBoundingSphere","BoundingSphereState","DONE","render","state","PENDING","enableTilt","bs","FAILED","EntityView","mapProjection","clientWidth","clientHeight","resolutionScale","devicePixelRatio","frustum","aspectRatio","getCamera","getOlView","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","visibility","interactions","throwOnUnitializedMap_","getInteractions","arr","clear","addInteraction","interaction","removeInteraction","filter","rootGroup","getVisible","setVisible","getOverlayContainer","classList","remove","warmUp","timeout","csCamera","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","getAutoRenderLoop","setResolutionScale","setTargetFrameRate","isDef","defaultDataSource","entities","lookAtTransform","IDENTITY","to4326Transform","toCesiumPosition","coo","coo4326","CallbackProperty","TRANSPARENT","olcsSynchronizedOverlay","OverlaySynchronizer","overlays_","getOverlays","overlayContainerStopEvent_","className","parentElement","overlayContainer_","overlayMap_","getOverlayContainerStopEvent","addOverlays","addOverlayFromEvent_","removeOverlayFromEvent_","overlay","addOverlay","cesiumOverlay","synchronizer","parent","overlayId","removedOverlay","removeOverlay","csOverlay","stableSort","olcsAbstractSynchronizer","RasterSynchronizer","cesiumLayers_","ourLayers_","ImageryLayerCollection","removeAll","convertLayerToCesiumImageries","viewProj","tileLayerToImageryLayer","olLayerItem","updateCesiumLayerProperties","previousStyleFunction","currentStyleFunction","csObj","_imageryCache","imageryProvider","cache_","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","layer1","layer2","raiseToTop","olOverlay","transform","removeNode","removeChildren","SynchronizedOverlay","getOptions","scenePostRenderListenerRemover_","synchronizer_","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","attributeObserver_","listenerKeys_","setPropertyFromEvent","setPropertyFromEvent_","setProperties","getProperties","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","childNodes","node","nodeType","getScene","updatePixelPosition","container","stopEvent","insertFirst","insertBefore","handlePositionChanged","sourceProjection","getMap","cloneNode","nodeName","ctx","drawImage","Node","TEXT_NODE","dispatchEvent","MouseEvent","nodes","getElement","parentNode","clonedNode","globeHeight","tilesLoaded","cartesian","ellipsoidBoundingSphere","occluder","Occluder","isPointVisible","cullingVolume","computeCullingVolume","direction","computeVisibility","pixelCartesian","cartesianToCanvasCoordinates","pixel","mapSize","updateRenderedPosition","olLayerLayer","olLayerImage","olLayerVector","olLayerVectorTile","olcsFeatureConverter","VectorSynchronizer","opt_converter","converter","csAllPrimitives_","destroyPrimitives","updateLayerVisibility","csPrimitive","visible","layerVisible","show","csPrimitives","olListenKeys","onAddFeature","onRemoveFeature","Billboard","LazyLoader","url_","script","onload","onerror","head","olcsContribLazyLoader","olObservable","Manager","cesiumUrl","cameraExtentInRadians","cesiumIonDefaultAccessToken","cesiumUrl_","boundingSphere_","blockLimiter_","promise_","cesiumIonDefaultAccessToken_","cesiumInitialTilt_","fogDensity","fogSSEFactor","minimumZoomDistance","maximumZoomDistance","limitCameraToBoundingSphereRatio","cesiumLazyLoader","onCesiumLoaded","rect","DEFAULT_VIEW_RECTANGLE","fromRectangle3D","Ion","defaultAccessToken","instantiateOLCesium","configureForUsability","configureForPerformance","terrainProvider","createWorldTerrain","fog","density","screenSpaceErrorFactor","sscController","depthTestAgainstTerrain","backgroundColor","limitCameraToBoundingSphere","fromCartesian","ratio","currentlyFlying","flying","unblockLimiter","flyToBoundingSphere","cancel","toggle3d","is3DCurrentlyEnabled","resetToNorthZenith","rotateAroundBottomCenter","set3dWithView","lon","lat","elevation","headingDeg","pitchDeg","is3dEnabled","getTiltOnGlobe","tiltOnGlobe","computeSignedTiltAngleOnGlobe","angle","bottom","pickBottomPoint","setHeadingUsingBottomCenter","getOl3d","getCesiumViewMatrix","flyToRectangle","getRectangleCameraCoordinates","mag","magnitude","multiplyByScalar","flyTo","endTransform","getCameraExtentRectangle","linear","linearEasing","olLayerTile","transformExtent","olSourceImageStatic","olSourceImageWMS","olSourceTileImage","olSourceTileWMS","olSourceVectorTile","defaultImageLoadFunction","olcsCoreOLImageryProvider","VectorTileLayer","getExtentCenter","exports","computePixelSizeAtCoordinate","getPixelDimensions","pixelRatio","computeBoundingBoxAtTarget","amount","pixelSize","Transforms","eastNorthUpToFixedFrame","bottomLeft","multiplyByPoint","topRight","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","applyTransform","output","stride","createMatrixAtCoordinates","translation","ZERO","rawMatrix","quaternion","Quaternion","fromAxisAngle","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","axis","opt_options","clamp","defaultValue","duration","easing","callback","lastProgress","oldTransform","start","Date","step","timestamp","timeDifference","progress","stepAngle","rotate","bottomCenter","angleToZenith","computeAngleToZenith","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","fromTranslation","pickOnTerrainOrEllipsoid","ray","getPickRay","pick","pickEllipsoid","Ray","IntersectionTests","rayEllipsoid","getPoint","signedAngleBetween","convertLongitudeRange","bottomFovRay","fovy2","fovy","matrix","second","a","b","cosine","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","ext","sourceToImageryProvider","olMap","skip","provider","getUrl","getImageLoadFunction","sourceProps","attributions","getAttributions","params","getParams","getSourceProjection","isCesiumProjection","getImageExtent","fromCode","getCode","split","u","replace","attributionsFunction","attributionsFunctionToCredits","layerOptions","forcedExtent","cesiumLayer","ImageryLayer","csLayer","layerOpacity","alpha","coordinate","toCartesian","cartesians","proj4326","properties","byteToFloat","fromCssColorString","CanvasPattern","CanvasGradient","fillStyle","fillRect","convertUrlToCesium","subdomains","re","match","exec","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","currentHeading","normalizeView","constrainResolution","getConstrainedResolution","is3857","is4326","zoom","frameState","viewState","html","Credit","metersPerUnit","getMetersPerUnit","visibleMapUnits","relativeCircumference","cos","abs","visibleMeters","requiredDistance","tan","Tile","TileSource","olUseNewCoordinates","tileSource","wrapX","tileCoord","getTileCoordForTileUrlFunction","OLImageryProvider","opt_fallbackProj","source_","fallbackProj_","ready_","tilingScheme_","rectangle_","shouldRequestNextLevel","proxy","proxy_","DefaultProxy","errorEvent_","handleSourceChanged_","getState","numberOfLevelZeroTilesX","numberOfLevelZeroTilesY","forEachTileCoord","xIndex","yIndex","GeographicTilingScheme","level","calculateExtent","getSize","tileUrlFunction","getTileUrlFunction","z_","y_","call","getURL","ImageryProvider","loadImage","defineProperties","tg","getTileGrid","getTileSize","getMaxZoom","VectorLayerCounterpart","layerProjection","BillboardCollection","rootCollection_","angleInRadians","angleInDegrees","param","supportsImageRenderingPixelatedResult_","imageRenderingValueResult_","setAttribute","tmp","observable","uidCounter_","olcs_uid","compareFnc","index","sort","removeChild","lastChild","isSupported"],"sourceRoot":""}